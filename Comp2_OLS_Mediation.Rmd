---
title: "SPI~DI_Validation"
output: html_document
---
# POLS MEDIATION 

# Correlation & R-SQ: SPI ~ DI [ADDED TO APPENDIX E]
```{r}
#correlation - variance 
spi_di_cor <- cor(fd_fe_data$spi_comp, fd_fe_data$di_score, use = "complete.obs")
spi_di_cor

#r-squared
spi_di_cor_2 <- cor(fd_fe_data$spi_comp, fd_fe_data$di_score, use = "complete.obs")^2
spi_di_cor_2
```
Correlation: 0.6761706
R-sq: 0.4572067

## POLS: SPI ~ DI, the effect of democracy on SPI Performance
[DR. DI GENNERO's MODEL + My Controls] 
```{r}
# set working directory 
setwd("~/Documents/GitHub/QMSS_Thesis_Sanchez")

#load libraries/packages
source("packages.R")

#load data 
#merged <- read_csv("data/Main CSV Outputs/merged_final_df.csv)

# Full OLS model: SPI ~ DI
ols_spi_di <- plm(formula = spi_comp ~ di_score + log_gdppc + #I(log_gdppc^2) +
                    factor(year), 
                        index = c("country_code", "year"),
                        model = "pooling", 
                        data = fd_fe_data)
summary(ols_spi_di, vcov = vcovHC(ols_spi_di, cluster = "group", type = "HC1"))

# plot relationship
ggplot(fd_fe_data, aes(x = di_score, y = spi_comp)) + 
  geom_point(color = "steelblue", size = 1, alpha = 0.65) +
  geom_smooth(method = "lm", 
              se = TRUE, color = "darkblue", size = 1) +
  labs(
    title = "Effect of Democracy Levels on SPI Scores",
    x = "Democracy Score",
    y = "SPI Composite (0-100 Scale)"
  ) +
  theme_minimal()
```

- Quadratic needed for log_gdppc? No, not significant (p > 0.05)

## POLS: SDG ~ DI + SPI (Mediator), The effect of democracy on SDG Performance
```{r}
# Total Effect: (Y ~ X + M) Check if regime type directly affects SDG scores (without SPI) + Controls & RobustSEs
sdg_di_ols <- plm(formula = sdg_overall ~ di_score + spi_comp + log_gdppc + I(log_gdppc^2) + 
                    factor(year), 
                        index = c("country_code", "year"),
                        model = "pooling", 
                        data = fd_fe_data)
summary(sdg_di_ols, vcov = vcovHC(sdg_di_ols, cluster = "group", type = "HC1"))

# Plot relationship
ggplot(fd_fe_data, aes(x = di_score, y = sdg_overall)) + 
  geom_point(color = "#EE6A50", size = 1, alpha = 0.65) +
  geom_smooth(method = "lm", 
              se = TRUE, color = "darkred", size = 1) +
  labs(
    title = "Effect of Democracy Levels on SDG Performance",
    x = "Democracy Score",
    y = "SDG Progress (0-100 Scale)"
  ) +
  theme_minimal()
```
This OLS is applied to check if democracy level directly affects SDG scores (without SPI). This is the first step in the mediation analysis to test if statistical capacity mediates the relationship between democracy levels and sustainable development progress. Controlling for log GDP Per Capita, a one point increase of SDG performance (0-100 scale) is associated with a 1.2 point increase in democracy levels of countries, on average. This relationship is highly statistically significant (p < 0.001). 

di_score: 1.215181 (p <2e-16)
log_gdppc: 4.412016 (p <2e-16)

- Quadratic needed for log_gdppc? Yes, significant (p < 0.001***)

## OLS Democracy Score's Effect on SDG (Y ~ M ~ X)
- ACME (Average Causal Mediation Effect): SPI’s indirect effect.
- ADE (Average Direct Effect): Regime type’s direct effect, excluding SPI
```{r}
#OLS Mediator: Check if regime type affects SPI (M)
med_spi_ols <- lm(spi_comp ~ di_score + log_gdppc + factor(year), data = fd_fe_data)
summary(med_spi_ols, vcov = vcovHC(med_spi_ols, cluster = "group", type = "HC1"))

#OLS Outcome: Check if SPI affects SDG scores (Y ~ M) while controlling for regime type (X)
output_sdg_ols <- lm(sdg_overall ~ spi_comp + di_score + log_gdppc + factor(year), data = fd_fe_data)
summary(output_sdg_ols, vcov = vcovHC(output_sdg_ols, cluster = "group", type = "HC1"))

#OLS Mediation test: Quantify how much of regime type’s effect on SDGs operates through SPI
set.seed(125) #for replicability 
med_model <- mediate(model.m = med_spi_ols, 
                     model.y = output_sdg_ols, 
                     treat = "di_score", 
                     mediator = "spi_comp", 
                     boot = TRUE,
                     sims = 1000)
summary(med_model)
```
*Results:*
ACEM: SPI’s indirect effect = 1.0285  units (p < 2e-16***)
ADE: Regime type’s direct effect, excluding SPI = 0.2027  (p = 0.064) [just over 0.05]
Total Effect: = 1.2312 units (p < 2e-16***)
Proportion Mediated: = 0.8347 or 83.47% of total units

`Proportion Mediated` = the percent difference between the total effect (SDG ~ DI) and indirect ACEM effect (+ SPI)

Interpretation: A 1-unit DI increase boosts SDG scores by 1.2312 total units, with 1.0285 units (83.47% of units) transmitted through SPI. The remaining 0.2027 units represents democracy score's effect (e.g., governance reforms unrelated to statistics) on SDG progress. 

Because the indirect effect of SPI on sdg_overall (ACME) is highly significant (p < 0.001), there is evidence to suggest that SPI mediates the regime-SDG relationship, based on the model. 

Because the ADE (the direct effect between di_score on sdg_overall) is not significant (or just barely), SPI has a complete/almost-complete effect on SDG status when SPI is accounted for, based on the model. 

*Robustness check: sensitivity analysis*
```{r}
#Sensitivity Analysis: Tests how robust mediation findings are to potential unmeasured confounding variables
sens_med <- medsens(med_model, rho.by = 0.1)
summary(sens_med)
plot(sens_med)
```
This tests how much unmeasured confounding would be needed to nullify the mediation effect. Based on the results, a rho = 0.5 indicates the mediation is moderately robust. there would need to be relatively strong unmeasured cofounders to nullify the results.

Any unmeasured cofounder would need to explain 25% of the residual variance in both models to eliminate the mediation effect (R²_MR²_Y = 0.25). 

