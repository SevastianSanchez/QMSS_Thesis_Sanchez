---
title: "First Tests OLS, FDs"
author: "Sevastian Sanchez"
date: "`r Sys.Date()`"
output: html_document
---
# All Countries, Preliminary Analysis (SPI x SDGs)
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Libraries 
```{r}
library(devtools)
library(tidyr)
library(dplyr)
library(vdemdata) # call vdem package 
library(readr) #loading data 
library(readxl)
```


##CLEANING / WRANGLING 
```{r}
#Vdem package from github 
vdem <- vdemdata::vdem  #loading data 

#spi csv from github 
url <- "https://raw.githubusercontent.com/worldbank/SPI/refs/heads/master/03_output_data/SPI_index.csv"
spi <- read_csv(url)

#sdg excel from directory 
sdg <- read_excel("~/Desktop/OneDrive/OneDrive/QMSS Thesis/Datasets/SDR2024-data.xlsx", sheet = "Backdated SDG Index")

merged_L3 <- read_csv("~/Documents/GitHub/Timeseries-SDGs-SPI-Vars/merged_L3.csv")
```

##Vdem Wrangling / Cleaning
```{r}
#selecting democracy indices and controls 
vdem <- vdem %>%
  dplyr::select(country_name, country_text_id, year, v2x_regime, v2x_regime_amb, v2x_polyarchy, v2x_libdem, v2x_partipdem, v2x_delibdem, v2x_egaldem, v2xel_frefair, v2x_accountability, v2x_veracc, v2x_horacc, v2x_diagacc, v2xca_academ, e_gdp, e_gdppc, e_wb_pop) %>%
  filter(year > 1999) %>% #Only 1999 and up 
  rename(country_code = country_text_id, #renaming country code (new_name = old_name)
         regime_type = v2x_regime, 
         regime_type_amb = v2x_regime_amb,
         elect_dem = v2x_polyarchy,
         lib_dem = v2x_libdem,
         part_dem = v2x_partipdem,
         delib_dem = v2x_delibdem,
         egal_dem = v2x_egaldem,
         freefair = v2xel_frefair,
         freefair_ord = e_v2xel_frefair,
         accountability = v2x_accountability,
         vt_account = v2x_veracc,
         hz_account = v2x_horacc,
         diag_account = v2x_diagacc,
         academ_free = v2xca_academ,
         freexp_altinfo = v2x_freexp_altinf,
         gdp = e_gdp,
         gdp_pc = e_gdppc,
         population = e_wb_pop)
  
# To be added: 

#vdem$v2xca_academ <- vdem$v2xca_academ*100
#vdem$v2x_libdem <- vdem$v2x_libdem*100
```


#SPI wrangling / cleaning 
```{r}
#selecting and renaming spi vars 
spi <- spi %>% 
  select(country, iso3c, date, SPI.INDEX, SPI.INDEX.PIL1, SPI.INDEX.PIL2, SPI.INDEX.PIL3, SPI.INDEX.PIL4, SPI.INDEX.PIL5) %>% 
  rename(country_code = iso3c) %>% 
  rename(year = date) %>% 
  rename(spi_comp = SPI.INDEX) %>% #SPI composite score, average of p1-5
  rename(p1_use = SPI.INDEX.PIL1) %>% #SPI pillar 1, Data use 
  rename(p2_services = SPI.INDEX.PIL2) %>% #SPI pillar, 2 Data services 
  rename(p3_products = SPI.INDEX.PIL3) %>% #SPI pillar, 3 Data products  
  rename(p4_sources = SPI.INDEX.PIL4) %>% #SPI pillar, 4 Data sources 
  rename(p5_infra = SPI.INDEX.PIL5) #SPI pillar 5, Data infrastructure
```

##SDG wrangling / cleaning 
```{r}
#select vars 
sdg <- sdg %>% 
  dplyr::select("country_code", "country_name", "year", "sdg_overall", "goal1", "goal2", "goal3", "goal4", "goal5", "goal6", "goal7", "goal8", "goal9", "goal10", "goal11", "goal12", "goal3", "goal14", "goal15", "goal16", "goal17")

```

# Merging & subsetting (case study: Spain)
```{r}
#merge spi, sdg and vdem data 
merged <- merge(sdg, vdem, by = c("country_code", "year")) 
merged <- merge(merged, spi, by = c("country_code", "year"))

#data type changes 
merged$year <- as.integer(merged$year)
merged <- merged %>% mutate_at(c("spi_overall", "spi_p1", "spi_p2", "spi_p3", "spi_p4", "spi_p5"), as.numeric)

# subset for Spain 
merged_ESP <- merged[merged$country_code=="ESP",]

#subset for only 2019 
merged_2019_L3 <- merged[merged$year==2019,]

#explorting 2019 data; will save to current working directory 
write.table(merged_2019_L3, file = "merged_2019_L3.csv", row.names=F, sep = ",")

#explorting time data; will save to current working directory 
write.table(merged, file = "merged_L3.csv", row.names=F, sep = ",") #### USING THIS DATA 
```


## NAIVE OLS 
**Aggregated SPI & SDG Scores**
*H0: Null, there is no relationship*
*H1: there is a statistically significant correlation between overall SPI and SDG composite scores*
```{r}
#correlation 
cor(merged_L3$sdg_overall, merged_L3$spi_overall)

#OLS lm 
lm1 <- lm(sdg_overall ~ spi_overall, data = merged_L3)
lm1
```

## OLS W/INTERACTIONS 
**SPIxDemocracyScore & SDG 
```{r}

```


## MULTIPLE LINEAR REGRESSION 
**Disaggregated by Development Status**
```{r}

```


## 
