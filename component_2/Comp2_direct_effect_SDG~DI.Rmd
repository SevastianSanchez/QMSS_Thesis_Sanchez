---
title: "Comp2_direct_effect_SDG~DI"
title: "Component 2, Direct Effect, SDG ~ DI"
author: "Sevastian Sanchez"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: no
    toc_depth: '3'
    number_sections: yes
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: yes
    number_sections: yes
    highlight: tango
    theme: default
    fig_caption: yes
    df_print: tibble
  word_document: default
  urlcolor: blue
---

```{r}
knitr::opts_chunk$set(
  echo = TRUE, warning = FALSE, message = FALSE,
  tidy = TRUE, tidy.opts = list(width.cutoff = 60) 
)
```

# Set up 
```{r}
# set working directory
setwd("~/Documents/GitHub/QMSS_Thesis_Sanchez")

#load libraries/packages
source("packages.R")

# load data
source("Comp2_panel_wrangling.R")

panel_data <- panel_data %>% 
  dplyr::select(country_name, country_code, year, sdg_overall, di_score, log_gdppc, income_level_recoded) %>%
  dplyr::arrange(country_code, year)

# how many countries 
length(unique(panel_data$country_code)) 

# check dimensions
dim(panel_data) 
```

## Converting to panel data frame
```{r}
panel_data <- pdata.frame(panel_data, index = c("country_code", "year"))
pdim(panel_data) # check panel dimensions
```

# Direct Effect: SDG ~ DI
```{r}
# Model POLS: Basic FE model with DI as predictor
model_pols <- plm(formula = sdg_overall ~ di_score
              + plm::lag(di_score, 1) 
              + plm::lag(di_score, 2) 
              + log_gdppc 
              + factor(year),
              data = panel_data,
              model = "pooling")
summary(model_pols, vcov = vcovHC(model_pols, cluster = "group", type = "HC1"))
```

```{r}
# Model FD: Basic model with DI as predictor
model_fd <- plm(formula = sdg_overall ~ di_score
              + plm::lag(di_score, 1) 
              + plm::lag(di_score, 2) 
              + log_gdppc 
              + factor(year),
              data = panel_data,
              model = "fd")
summary(model_fd, vcov = vcovHC(model_fd, cluster = "group", type = "HC1"))

# CI for FD model with Lag2
coef <- coef(model_fd)
se <- sqrt(diag(vcovHC(model_fd, cluster = "group", type = "HC1")))  # Get standard errors
crit_value <- qt(0.975, df = nobs(model_fd)-length(coef(model_fd)))
ci_low <- coef - crit_value * se
ci_high <- coef + crit_value * se
cbind(ci_low, ci_high)

# joint significance - FD
linearHypothesis(
  model_fd,
  c("di_score = 0", "plm::lag(di_score, 1) = 0", "plm::lag(di_score, 2) = 0"),
  vcov. = vcovHC(model_fd, cluster = "group", type = "HC1")
)
# ensure correct names 
# names(coef(model_fd))

# cumulative effect - FD
linearHypothesis(
  model_fd,
  c("di_score + plm::lag(di_score, 1) + plm::lag(di_score, 2) = 0"),
  vcov. = vcovHC(model_fd, cluster = "group", type = "HC1")
)
```
**Results:** The joint significance tests for FD show no evidence that DI variables are jointly significant in explaining changes in SDG overall scores (Chisq = 4.3277, p = 0.2282). This suggests that DI may not have a meaningful immediate impact on SDG outcomes when considering both current and lagged effects.

In terms of *cumulative impact*, based on the FD model and panel data, showed no evidence of cumulative total impacts of changes in di_score (at current, lag 1, or lag 2) on SPI —over these periods (stat = 2e-04, p = 0.9879).

```{r}
# Model FE: Basic model with DI as predictor
model_fe <- plm(formula = sdg_overall ~ di_score
              + plm::lag(di_score, 1) 
              + plm::lag(di_score, 2)
              + log_gdppc 
              + factor(year),
              data = panel_data,
              model = "within")
summary(model_fe, vcov = vcovHC(model_fe, cluster = "group", type = "HC1"))

# CI for FE model with Lag2
coef <- coef(model_fe)
se <- sqrt(diag(vcovHC(model_fe, cluster = "group", type = "HC1")))  # Get standard errors
crit_value <- qt(0.975, df = nobs(model_fe)-length(coef(model_fe)))
ci_low <- coef - crit_value * se
ci_high <- coef + crit_value * se
cbind(ci_low, ci_high)

# joint significance - FE
linearHypothesis(
  model_fe,
  c("di_score = 0", "plm::lag(di_score, 1) = 0", "plm::lag(di_score, 2) = 0"),
  vcov. = vcovHC(model_fe, cluster = "group", type = "HC1")
)
# ensure correct names 
# names(coef(model_fe))

# cumulative effect - FE
linearHypothesis(
  model_fe,
  c("di_score + plm::lag(di_score, 1) + plm::lag(di_score, 2) = 0"),
  vcov. = vcovHC(model_fe, cluster = "group", type = "HC1")
)
```
**Result:** The joint significance tests for FE show that the DI variables are jointly significant in explaining changes in SDG overall scores (Chisq = 7.8736, p = 0.0487). This suggests that DI has a meaningful incremental impact on SDG outcomes when considering both current and lagged effects.

In terms of *cumulative impact*, based on the FE model and panel data, results detected a total impact of changes in di_score (at current, lag 1, or lag 2) on SPI —over these periods (stat = 0.3742, p = 0.5407)


```{r}
rob_se_total_ef <- list(
  sqrt(diag(vcovHC(model_pols, cluster = "group", type = "HC1"))),
  sqrt(diag(vcovHC(model_fd, cluster = "group", type = "HC1"))),
  sqrt(diag(vcovHC(model_fe, cluster = "group", type = "HC1")))
)
# Generate the stargazer table for Lag2 models
stargazer(model_pols, model_fd, model_fe, 
          se = rob_se_total_ef,
          title = " Total Effect: Static & Lagged Effects (SDG ~ DI)",
          align = TRUE,
          dep.var.labels = "SDG Overall Score",
          column.labels = c("POLS", "FD", "FE"),
          covariate.labels = c("DI Composite", "Lagged DI (t-1)", "Lagged DI (t-2)", "Log(GDP per-capita)", "Intercept"),
          notes = "Robust standard errors clustered by country in parentheses",
          type = "html", 
          report = "vcs*", 
          #keep.stat = c("n", "rsq", "adj.rsq"),
          omit = "factor\\(year\\)",  # Omits year FE from display
          out = "component_2/figures/total_effect/total_ef_L2_mods.html")
```

