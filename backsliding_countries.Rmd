---
title: "backsliding_countries"
output: html_document
---

# preparation 
```{r}
setwd("~/Documents/GitHub/QMSS_Thesis_Sanchez")

#load libraries 
source("packages.R")

#load data 
event_data <- read_csv("data/Main CSV Outputs/merged_final_df.csv")

#selecting vars
event_data <- event_data %>% 
  dplyr::select(country_code, year, sdg_overall, spi_comp, di_score, aut_ep, dem_ep, elect_dem, lib_dem, part_dem, delib_dem, egal_dem, academ_free, income_level, income_level_lab, log_gdppc, population) %>% 
  arrange(country_code, year) %>%  # Critical for correct lagging
  filter(year >= 2016)

# adding has_aut_ep and has_dem_ep for regressing regimes (experienced atleast 1 aut_ep/dem_ep)
event_data <- event_data %>%
  # Group by country to check for any event
  group_by(country_code) %>%
  mutate(has_aut_ep = any(aut_ep == 1, na.rm = TRUE)) %>%
  mutate(has_dem_ep = any(dem_ep == 1, na.rm = TRUE)) %>% #also had dem_ep countries 
  ungroup() %>% 
  filter(has_aut_ep == TRUE | has_dem_ep == TRUE)

# subgroups: regressing and democratizing coutries 
aut_data <- event_data %>% filter(has_aut_ep == TRUE)
dem_data <- event_data %>% filter(has_dem_ep == TRUE)
```

# Backsliding FD Models 
```{r}
###### SPI ~ DI (M ~ X) ######
fd_spi_di_aut <- plm(
  formula = spi_comp ~ di_score + log_gdppc,
  index = c("country_code", "year"),
  data = aut_data, 
  model = "fd" #FD
) 
# Country-level custard Robust SEs
summary(fd_spi_di_aut, vcov = vcovHC(fd_spi_di_aut, cluster = "group", type = "HC1"))

###### SDG ~ SPI (Y ~ M) ######
fd_sdg_spi_aut <- plm(
  formula = sdg_overall ~ spi_comp + di_score + log_gdppc,
  index = c("country_code", "year"),
  data = aut_data, 
  model = "fd"
)
# Country-level custard Robust SEs
summary(fd_sdg_spi_aut, vcov = vcovHC(fd_sdg_spi_aut, cluster = "group", type = "HC1"))
```
On average, when backsliding countries experience a change in Democracy score, is there a change in statistical capacity (SPI)? On average, when backsliding countries experience a change in statistical capacity (SPI) do they similalry experience a change in SDG score? 

# Backsliding FE Models
```{r}
###### SPI ~ DI (M ~ X) ######
fe_spi_di_aut <- plm(
  formula = spi_comp ~ di_score + log_gdppc + factor(year),
  index = c("country_code", "year"),
  data = aut_data,
  model = "within" 
)
summary(fe_spi_di_aut, vcov = vcovHC(fe_spi_di_aut, cluster = "group", type = "HC1")) # Robust SEs

###### SDG ~ SPI (Y ~ M) ######
fe_sdg_spi_aut <- plm(
  sdg_overall ~ spi_comp + di_score + log_gdppc + factor(year),
  index = c("country_code", "year"),
  data = aut_data,
  model = "within" 
)
summary(fe_sdg_spi_aut, vcov = vcovHC(fe_sdg_spi_aut, cluster = "group", type = "HC1")) # Robust SEs
```

# Single Country: Hungary 
```{r}
#filter for hungary 
hun_regressed <- aut_data %>% 
  filter(country_code == "HUN")

# FE model - Hungary 
fe_testing <- plm(
  formula = spi_comp ~ di_score + log_gdppc,
  data = aut_data, sub = (country_code == 'HUN'),
  index = c("country_code", "year"),
  model = "within")
summary(fe_testing, vcov = vcovHC(fe_testing, type = "HC3"))
```

#testing for autocorrelation 
```{r}
lmtest::bgtest(fe_testing)
lmtest::bgtest(fe_testing, order = 1)
```


```{r}
# subset of countries that experienced atleast 1 democratization event 
democratized <- merged %>% 
  group_by(country_code) %>%
  filter(dem_ep == 1) %>%
  ungroup()
```
