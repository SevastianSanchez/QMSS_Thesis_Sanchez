---
title: "model_testing"
output: html_document
---

```{r}
#load libraries/packages
source("packages.R")

#load function 
source("df_years()_Function.R")
merged_testing <- df_years(yr1 = 2015) 
```


# OLS: including regime variable [which is best?]
```{r}
# 1. regime_type_2 (0 or 1) control
lm1_reg2 <- lm(sdg_overall ~ spi_comp + regime_type_2 + log(gdppc) + population,
                        data = merged_testing)
summary(lm1_reg2)

# 2. lib_dem (continuous 0-1) control
lm2_regcont <- lm(sdg_overall ~ spi_comp + lib_dem + log(gdppc) + population,
                        data = merged_testing)
summary(lm2_regcont)

# 3. regime_type_2 (0 or 1) interaction 
lm3_reg2_int <- lm(sdg_overall ~ spi_comp + spi_comp*regime_type_2 + log(gdppc) + population,
                        data = merged_testing)
summary(lm3_reg2_int)

# 4. lib_dem (continuous 0-1) interaction
lm4_libd_int <- lm(sdg_overall ~ spi_comp + spi_comp*lib_dem + log(gdppc) + population,
                        data = merged_testing)
summary(lm4_libd_int)

# 5. regime_type_2 (0 or 1) interaction + control
lm5_reg2_int_cont <- lm(sdg_overall ~ spi_comp + regime_type_2 + spi_comp*regime_type_2 + log(gdppc) + population,
                        data = merged_testing)

summary(lm5_reg2_int_cont)

# 6. lib_dem (continuous 0-1) interaction + control 
lm6_libd_int_cont <- lm(sdg_overall ~ spi_comp + lib_dem + spi_comp*lib_dem + log(gdppc) + population,
                        data = merged_testing)
summary(lm6_libd_int_cont)

# just interaction?
lm7_libd_int_cont <- lm(sdg_overall ~ spi_comp + spi_comp*lib_dem + log(gdppc) + population,
                        data = merged_testing)
summary(lm7_libd_int)
```
- Interactions are not statistically significant (lib_dem or )



## Multiple Regression: Xs = p1-5

```{r}
# y & x vars + controls
sdg_overall_score <- merged_testing$sdg_overall 
p_1 <- merged_testing$p1_use #insert x var 2
p_2 <- merged_testing$p2_services #insert x var 3
p_3 <- merged_testing$p3_products #insert x var 3
p_4 <- merged_testing$p4_sources #insert x var 3
p_5 <- merged_testing$p5_infra #insert x var 3
gdppc <- merged_testing$gdppc

df_spi_p1to5 <- data.frame(p_1, p_2, p_3, p_4, p_5, gdppc)

#OLS lm & full summary table 
lm2 <- lm(sdg_overall_score ~ p_1 + p_2 + p_3 + p_4 + p_5 + log(gdppc), data=df_spi_p1to5)
summary(lm2)

#plotting residuals
plot(lm2)
#plotting scatterplot 
plot(df$y_var, df$x1_var)
abline(lm2)
```

# OLS: SPI ~ DI [DR. DI GENNERO's MODEL]
```{r}
ols_spi_di <- lm(spi_comp ~ di_score + log(gdppc) + population + year_fct + gini, data = merged_testing)
summary(ols_spi_di)

ggplot(merged_testing, aes(di_score, spi_comp))+
  geom_point()+
  geom_smooth(method=lm) #makes the line into a linear model

#correlation - variance 
spi_di_cor <- cor(merged_testing$spi_comp, merged_testing$di_score, use = "complete.obs")
spi_di_cor

#r-squared
spi_di_cor_2 <- cor(merged_testing$spi_comp, merged_testing$di_score, use = "complete.obs")^2
spi_di_cor_2
```

## R Stan, GLM, Markove  
```{r}
library(rstanarm)

gml_testing <- stan_glm(sdg_overall ~ spi_comp + regime_type + regime_type*spi_comp + log(gdppc) + population, data = merged_testing)

# glm_testing
print(gml_testing)
summary(gml_testing)
```

#First difference
```{r}
fd_model <- plm(
  spi_comp ~ di_score + log(gdppc) + population + year_fct + gini,
  data = merged_testing,
  index = c("country_code", "year"),
  model = "fd"
)

summary(fd_model)

# Check for serial correlation
lmtest::dwtest(fd_model)

```


## Fixed Effects Model
```{r}
library(plm)
fe_model <- plm(sdg_overall ~ spi_comp + regime_type + gdppc + population,
                data = merged_testing, 
                index = c("country_code", "year"), 
                model = "within")

summary(fe_model)
```


# Mediation Model: SDG ~ SPI(DI)
```{r}
# Model SPIâ€™s effect on SDG outcomes with regime change as mediator

library(mediation)

med_model <- mediate(
  model.m = lm(spi_comp ~ di_score + log(gdppc) + population + gini, data = fd_fe_data),
  model.y = lm(sdg_overall ~ spi_comp + di_score + log(gdppc) + population + gini, data = fd_fe_data),
  treat = "aut_ep",
  mediator = "spi_comp"
)

summary(med_model)
```


# Significance of factor(year) Dummy Variable 

## factor(year) for OLS: SDG ~ SPI
```{r}
#excludes year dummy 
ols_spi <- lm(y_var_sdg ~ x_var_spi + log_gdppc + population + di_score + gini, data = merged)
summary(ols_spi)

#includes year dummy 
ols_spi_fyr <- lm(y_var_sdg ~ x_var_spi + log_gdppc + population + di_score + gini + factor(year), data = merged)
summary(ols_spi_fyr)

# Joint significance
anova(ols_spi, ols_spi_fyr)
```

## factor(year) for OLS: SDG ~ SCI
```{r}
#excludes year dummy 
ols_sci <- lm(y_var_sdg ~ x_var_sci + log_gdppc + population + di_score + gini, data = merged)
summary(ols_sci)

#includes year dummy 
ols_sci_fyr <- lm(y_var_sdg ~ x_var_sci + log_gdppc + population + di_score + gini + factor(year), data = merged)
summary(ols_sci_fyr)

# Joint significance
anova(ols_sci, ols_sci_fyr)
```

## factor(year) for OLS: SDG ~ SPI + SCI 
```{r}
#excludes year dummy 
ols_multiple <- lm(y_var_sdg ~ x_var_spi + x_var_sci + log_gdppc + population + di_score + gini, data = merged)
summary(ols_multiple)

#includes year dummy 
ols_multiple_fyr <- lm(y_var_sdg ~ x_var_spi + x_var_sci + log_gdppc + population + di_score + gini + factor(year), data = merged)
summary(ols_multiple_fyr)

# Joint significance
anova(ols_multiple, ols_multiple_fyr)
```


## VIF: Check for multicollinearity for models 
```{r}
# mainly concerned abt log_gdppc & factor(time)

#SPI VIF 
car::vif(ols_spi_fyr)  

#SCI VIF
car::vif(ols_sci_fyr) 

#SPI + SCI VIF
car::vif(ols_multiple_fyr) 
```

