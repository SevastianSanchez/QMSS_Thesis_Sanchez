#freefair_ord = e_v2xel_frefair,
accountability = v2x_accountability,
vt_account = v2x_veracc,
hz_account = v2x_horacc,
diag_account = v2x_diagacc,
academ_free = v2xca_academ,
freexp_altinfo = v2x_freexp_altinf,
gdp = e_gdp,
gdp_pc = e_gdppc,
population = e_wb_pop,
stat_agency = v3ststatag,
stat_yb_cov = v3ststybcov,
stat_yb_pub = v3ststybpub,
census = v3stcensus,
)
# To be added: e_v2xel_frefair,
#vdem$v2xca_academ <- vdem$v2xca_academ*100
#vdem$v2x_libdem <- vdem$v2x_libdem*100
#selecting and renaming spi vars
spi <- spi %>%
select(country, iso3c, date, SPI.INDEX, SPI.INDEX.PIL1, SPI.INDEX.PIL2, SPI.INDEX.PIL3, SPI.INDEX.PIL4, SPI.INDEX.PIL5) %>%
rename(country_name = country) %>%
rename(country_code = iso3c) %>%
rename(year = date) %>%
rename(spi_comp = SPI.INDEX) %>% #SPI composite score, average of p1-5
rename(p1_use = SPI.INDEX.PIL1) %>% #SPI pillar 1, Data use
rename(p2_services = SPI.INDEX.PIL2) %>% #SPI pillar, 2 Data services
rename(p3_products = SPI.INDEX.PIL3) %>% #SPI pillar, 3 Data products
rename(p4_sources = SPI.INDEX.PIL4) %>% #SPI pillar, 4 Data sources
rename(p5_infra = SPI.INDEX.PIL5) #SPI pillar 5, Data infrastructure
#full dataset
sci <- sci_df %>%
dplyr::select(country_name, country_code, Year, IQ.SCI.OVRL, IQ.SCI.MTHD, IQ.SCI.PRDC, IQ.SCI.SRCE, everything()) %>%
rename(year = Year,
sci_overall = IQ.SCI.OVRL,
sci_method = IQ.SCI.MTHD,
sci_periodicity = IQ.SCI.PRDC,
sci_source = IQ.SCI.SRCE)
sci$year <- as.numeric(sci$year)
#for merging (only sci score variables selected)
sci_scores <- sci %>%
select(country_name, country_code, year, sci_overall, sci_method, sci_periodicity, sci_source)
#select sdg goals & composite
sdg <- sdg %>%
dplyr::select("country_name", "country_code", "year", "sdg_overall", "goal1", "goal2", "goal3", "goal4", "goal5", "goal6", "goal7", "goal8", "goal9", "goal10", "goal11", "goal12", "goal3", "goal14", "goal15", "goal16", "goal17")
#merge spi, sci, sdg and vdem data
merged <- left_join(sdg, spi, by = c("year", "country_code"))
merged <- left_join(merged, sci_scores, by = c("country_code", "year"))
merged <- left_join(merged, vdem, by = c("country_code", "year"))
#rm duplicate col names
colnames(merged) <- make.unique(colnames(merged)) # Make column names unique
#data type changes
merged$year <- as.integer(merged$year)
merged <- merged %>%
mutate_at(c("spi_comp", "p1_use", "p2_services", "p3_products", "p4_sources", "p5_infra", "sci_overall", "sci_method", "sci_periodicity", "sci_source"), as.numeric)
#exporting time series data AS: merged_ts.csv ; will save to current working directory
write.table(merged, file = "merged_ts.csv", row.names=F, sep = ",")
#subset for only 2019
merged_cs_2019 <- merged[merged$year==2019,]
#exporting cross-sectional 2019 data AS: merged_cs2019; will save to current working directory
write.table(merged_cs_2019, file = "merged_cs2019.csv", row.names=F, sep = ",")
# subset for Spain
merged_esp_ts <- merged[merged$country_code=="ESP",]
#exporting Spain time series AS: merged_esp_ts; will save to current working directory
write.table(merged_esp_ts, file = "merged_esp_ts.csv", row.names=F, sep = ",")
# x & y variables
y_var <- merged$sdg_overall
x_var <- merged$spi_comp
df <- data.frame(x_var, y_var)
#correlation coefficient (x, y)
df.omit <- na.omit(df) # removing NA's -needed for cor() function
correlation <- cor(df.omit$x_var, df.omit$y_var)^2
string_corcoef <- "Correlation coefficient:"
paste(string_corcoef, correlation) # pasting result
#OLS lm & full summary table
lm1 <- lm(y_var ~ x_var, data=df)
summary(lm1)
#plotting scatterplot
plot(df$y_var, df$x_var)
abline(lm1)
# comparing correlation btw x-vars
merged.omit <- na.omit(merged)
sdg_spi_corr <- cor(merged.omit$sdg_overall, merged$spi_comp)^2 #x-var = spi
rm(merged.omit)
sdg_overall <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(sdg_overall, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$sdg_overall, df$x_var_spi)^2 #x-var 1 = spi
sdg_sci_corr <- cor(df$sdg_overall, df$x_var_sci)^2 #x-var 2 = sci
# ...
#more possible predictors ...
#paste results
paste(string_corcoef, sdg_spi_corr) # sdg x spi
paste(string_corcoef, sdg_sci_corr) # sdg x sci
sdg_overall <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(sdg_overall, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$x_var_spi, df$sdg_overall)^2 #x-var 1 = spi
sdg_sci_corr <- cor(df$sdg_overall, df$x_var_sci)^2 #x-var 2 = sci
# ...
#more possible predictors ...
#paste results
paste(string_corcoef, sdg_spi_corr) # sdg x spi
paste(string_corcoef, sdg_sci_corr) # sdg x sci
sdg_overall <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(sdg_overall, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$sdg_overall, df$x_var_spi)^2 #x-var 1 = spi
sdg_sci_corr <- cor(df$sdg_overall, df$x_var_sci)^2 #x-var 2 = sci
# ...
#more possible predictors ...
#paste results
paste(string_corcoef, sdg_spi_corr) # sdg x spi
paste(string_corcoef, sdg_sci_corr) # sdg x sci
sdg_overall <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(sdg_overall, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$sdg_overall, df$x_var_spi)^2 #x-var 1 = spi
sdg_sci_corr <- cor(df$sdg_overall, df$x_var_sci)^2 #x-var 2 = sci
# ...
#more possible predictors ...
#paste results
paste(string_corcoef, sdg_spi_corr) # sdg x spi
paste(string_corcoef, sdg_sci_corr) # sdg x sci
sdg_overall <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(sdg_overall, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$sdg_overall, df$x_var_spi)^2 #x-var 1 = spi
sdg_sci_corr <- cor(df$sdg_overall, df$x_var_sci)^2 #x-var 2 = sci
# ...
#more possible predictors ...
#paste results
paste(string_corcoef, sdg_spi_corr) # sdg x spi
paste(string_corcoef, sdg_sci_corr) # sdg x sci
sdg_overall <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(sdg_overall, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$sdg_overall, df$x_var_spi)^2 #x-var 1 = spi
sdg_sci_corr <- cor(df$sdg_overall, df$x_var_sci)^2 #x-var 2 = sci
# ...
#more possible predictors ...
#paste results
paste(string_corcoef, sdg_spi_corr) # sdg x spi
paste(string_corcoef, sdg_sci_corr) # sdg x sci
sdg_overall <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(sdg_overall, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$sdg_overall, df$x_var_spi)^2 #x-var 1 = spi
sdg_sci_corr <- cor(df$sdg_overall, df$x_var_sci)^2 #x-var 2 = sci
# ...
#more possible predictors ...
#paste results
paste(string_corcoef, sdg_spi_corr) # sdg x spi
paste(string_corcoef, sdg_sci_corr) # sdg x sci
sdg_overall <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(sdg_overall, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$sdg_overall, df$x_var_spi)^2 #x-var 1 = spi
sdg_sci_corr <- cor(df$sdg_overall, df$x_var_sci)^2 #x-var 2 = sci
# ...
#more possible predictors ...
#paste results
paste(string_corcoef, sdg_spi_corr) # sdg x spi
paste(string_corcoef, sdg_sci_corr) # sdg x sci
sdg_overall <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(sdg_overall, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$sdg_overall, df$x_var_spi)^2 #x-var 1 = spi
sdg_sci_corr <- cor(df$sdg_overall, df$x_var_sci)^2 #x-var 2 = sci
# ...
#more possible predictors ...
#paste results
paste(string_corcoef, sdg_spi_corr) # sdg x spi
paste(string_corcoef, sdg_sci_corr) # sdg x sci
?mutate_at
y_var <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(y_var, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$sdg_overall, df$x_var_spi)^2 #x-var 1 = spi
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
library(tidyr)
library(dplyr)
library(vdemdata) # call vdem package
library(readr) #loading data
library(readxl)
library(stargazer)
library(devtools)
library(tidyr)
library(dplyr)
library(vdemdata) # call vdem package
library(readr) #loading data
library(readxl)
library(stargazer)
library(devtools)
library(tidyr)
library(dplyr)
library(vdemdata) # call vdem package
library(readr) #loading data
library(readxl)
library(stargazer)
knitr::opts_chunk$set(echo = TRUE)
#Vdem package from github
vdem <- vdemdata::vdem  #loading data
#spi csv from github
url <- "https://raw.githubusercontent.com/worldbank/SPI/refs/heads/master/03_output_data/SPI_index.csv"
spi <- read_csv(url)
#sdg excel from directory
sdg <- read_excel("~/Desktop/OneDrive/OneDrive/QMSS Thesis/Datasets/SDR2024-data.xlsx", sheet = "Backdated SDG Index")
#sci csv from directory
sci_df <- read_csv("~/Desktop/OneDrive/OneDrive/QMSS Thesis/Datasets/SCI_All_Dim_TS.csv")
#Lab 3 merged
# merged_L3 <- read_csv("~/Documents/GitHub/Timeseries-SDGs-SPI-Vars/merged_L3.csv")
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
library(tidyr)
library(dplyr)
library(vdemdata) # call vdem package
library(readr) #loading data
library(readxl)
library(stargazer)
#selecting democracy indices and controls
vdem <- vdem %>%
dplyr::select(country_name, country_text_id, year, v2x_regime, v2x_regime_amb, v2x_polyarchy, v2x_libdem, v2x_partipdem, v2x_delibdem, v2x_egaldem, v2xel_frefair, v2x_accountability, v2x_veracc, v2x_horacc, v2x_diagacc, v2xca_academ, v2x_freexp_altinf, e_gdp, e_gdppc, e_wb_pop, v3ststybcov, v3ststybpub, v3stcensus, v3ststatag) %>%
filter(year > 1999) %>% #Only 1999 and up
rename(country_code = country_text_id, #renaming country code (new_name = old_name)
regime_type = v2x_regime,
regime_type_amb = v2x_regime_amb,
elect_dem = v2x_polyarchy,
lib_dem = v2x_libdem,
part_dem = v2x_partipdem,
delib_dem = v2x_delibdem,
egal_dem = v2x_egaldem,
freefair = v2xel_frefair,
#freefair_ord = e_v2xel_frefair,
accountability = v2x_accountability,
vt_account = v2x_veracc,
hz_account = v2x_horacc,
diag_account = v2x_diagacc,
academ_free = v2xca_academ,
freexp_altinfo = v2x_freexp_altinf,
gdp = e_gdp,
gdp_pc = e_gdppc,
population = e_wb_pop,
stat_agency = v3ststatag,
stat_yb_cov = v3ststybcov,
stat_yb_pub = v3ststybpub,
census = v3stcensus,
)
# To be added: e_v2xel_frefair,
#vdem$v2xca_academ <- vdem$v2xca_academ*100
#vdem$v2x_libdem <- vdem$v2x_libdem*100
#selecting and renaming spi vars
spi <- spi %>%
select(country, iso3c, date, SPI.INDEX, SPI.INDEX.PIL1, SPI.INDEX.PIL2, SPI.INDEX.PIL3, SPI.INDEX.PIL4, SPI.INDEX.PIL5) %>%
rename(country_name = country) %>%
rename(country_code = iso3c) %>%
rename(year = date) %>%
rename(spi_comp = SPI.INDEX) %>% #SPI composite score, average of p1-5
rename(p1_use = SPI.INDEX.PIL1) %>% #SPI pillar 1, Data use
rename(p2_services = SPI.INDEX.PIL2) %>% #SPI pillar, 2 Data services
rename(p3_products = SPI.INDEX.PIL3) %>% #SPI pillar, 3 Data products
rename(p4_sources = SPI.INDEX.PIL4) %>% #SPI pillar, 4 Data sources
rename(p5_infra = SPI.INDEX.PIL5) #SPI pillar 5, Data infrastructure
#full dataset
sci <- sci_df %>%
dplyr::select(country_name, country_code, Year, IQ.SCI.OVRL, IQ.SCI.MTHD, IQ.SCI.PRDC, IQ.SCI.SRCE, everything()) %>%
rename(year = Year,
sci_overall = IQ.SCI.OVRL,
sci_method = IQ.SCI.MTHD,
sci_periodicity = IQ.SCI.PRDC,
sci_source = IQ.SCI.SRCE)
sci$year <- as.numeric(sci$year)
#for merging (only sci score variables selected)
sci_scores <- sci %>%
select(country_name, country_code, year, sci_overall, sci_method, sci_periodicity, sci_source)
#select sdg goals & composite
sdg <- sdg %>%
dplyr::select("country_name", "country_code", "year", "sdg_overall", "goal1", "goal2", "goal3", "goal4", "goal5", "goal6", "goal7", "goal8", "goal9", "goal10", "goal11", "goal12", "goal3", "goal14", "goal15", "goal16", "goal17")
#merge spi, sci, sdg and vdem data
merged <- left_join(sdg, spi, by = c("year", "country_code"))
merged <- left_join(merged, sci_scores, by = c("country_code", "year"))
merged <- left_join(merged, vdem, by = c("country_code", "year"))
#rm duplicate col names
colnames(merged) <- make.unique(colnames(merged)) # Make column names unique
#data type changes
merged$year <- as.integer(merged$year)
merged <- merged %>%
mutate_at(c("spi_comp", "p1_use", "p2_services", "p3_products", "p4_sources", "p5_infra", "sci_overall", "sci_method", "sci_periodicity", "sci_source"), as.numeric)
#exporting time series data AS: merged_ts.csv ; will save to current working directory
write.table(merged, file = "merged_ts.csv", row.names=F, sep = ",")
#subset for only 2019
merged_cs_2019 <- merged[merged$year==2019,]
#exporting cross-sectional 2019 data AS: merged_cs2019; will save to current working directory
write.table(merged_cs_2019, file = "merged_cs2019.csv", row.names=F, sep = ",")
# subset for Spain
merged_esp_ts <- merged[merged$country_code=="ESP",]
#exporting Spain time series AS: merged_esp_ts; will save to current working directory
write.table(merged_esp_ts, file = "merged_esp_ts.csv", row.names=F, sep = ",")
# x & y variables
y_var <- merged$sdg_overall
x_var <- merged$spi_comp
df <- data.frame(x_var, y_var)
#correlation coefficient (x, y)
df.omit <- na.omit(df) # removing NA's -needed for cor() function
correlation <- cor(df.omit$x_var, df.omit$y_var)^2
string_corcoef <- "Correlation coefficient:"
paste(string_corcoef, correlation) # pasting result
#OLS lm & full summary table
lm1 <- lm(y_var ~ x_var, data=df)
summary(lm1)
#plotting scatterplot
plot(df$y_var, df$x_var)
abline(lm1)
# x & y variables
y_var <- merged$sdg_overall
x_var <- merged$spi_comp
df <- data.frame(x_var, y_var)
#correlation coefficient (x, y)
df.omit <- na.omit(df) # removing NA's -needed for cor() function
correlation <- cor(df.omit$x_var, df.omit$y_var)^2
string_corcoef <- "Correlation coefficient:"
paste(string_corcoef, correlation) # pasting result
#OLS lm & full summary table
lm1 <- lm(y_var ~ x_var, data=df)
summary(lm1)
#plotting scatterplot
plot(df$y_var, df$x_var)
abline(lm1)
y_var <- merged$sdg_overall
x_var_spi <- merged$spi_comp
x_var_sci <- merged$sci_overall
df <- data.frame(y_var, x_var_spi, x_var_sci)
df <- na.omit(df)
# comparing correlation btw x-vars
sdg_spi_corr <- cor(df$sdg_overall, df$x_var_spi)^2 #x-var 1 = spi
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
# Chunk 2
# loading data
load('arrests.clean.rdata')
library(tidyverse)
library(knitr)
library(estimatr)
library(weights)
library(ggpmisc)
library(modelsummary)
install.packages('modelsummary')
library(modelsummary)
library(tidyverse)
library(knitr)
library(estimatr)
library(weights)
library(ggpmisc)
library(modelsummary)
library(tidyverse)
library(knitr)
library(estimatr)
library(weights)
library(ggpmisc)
library(modelsummary)
library(tidyverse)
library(knitr)
library(estimatr)
library(weights)
library(ggpmisc)
library(modelsummary)
library(tidyverse)
library(knitr)
library(estimatr)
library(weights)
library(ggpmisc)
library(modelsummary)
library(tidyverse)
library(knitr)
library(estimatr)
library(weights)
library(ggpmisc)
library(modelsummary)
install.packages('data.table')
library(tidyverse)
library(knitr)
library(estimatr)
library(weights)
library(ggpmisc)
library(modelsummary)
# loading data
load('arrests.clean.rdata')
load("~/.RData")
---
title: "QMSS G5063 Final Project"
setwd("~/Documents/GitHub/stat_casualties_article")
# set working directory
setwd("~/Documents/GitHub/stat_casualties_article")
# set working directory
setwd("~/Documents/GitHub/stat_casualties_article copy")
#load libraries/packages
# set working directory
setwd("~/Documents/GitHub/stat_casualties_articlecopy")
setwd("~/Documents/GitHub/stat_casualties_study")
setwd("~/Documents/GitHub/stat_casualties_study")
#load libraries/packages
source("packages.R")
# load data
source("Comp2_panel_wrangling.R")
# Function to plot trends for specified countries and variables
plot_trends <- function(data,
countries,        # vector of country codes
variables,        # vector of variable names
use_zscore = FALSE,
start_year = 2015,
end_year = max(data$year, na.rm = TRUE),
facet_by = "country") {  # "country" or "variable"
# Filter data
plot_data <- data %>%
filter(country_code %in% countries,
year >= start_year,
year <= end_year) %>%
select(year, country_code, country_name, all_of(variables))
# Check if data exists
if (nrow(plot_data) == 0) {
stop("No data available for specified countries/variables/years")
}
# Apply z-score transformation if requested
if (use_zscore) {
plot_data <- plot_data %>%
group_by(country_code) %>%
mutate(across(all_of(variables),
~ scale(.) %>% as.vector(),
.names = "{.col}_z")) %>%
ungroup() %>%
select(-all_of(variables)) %>%
rename_with(~ str_remove(., "_z$"), ends_with("_z"))
}
# Reshape to long format
plot_data_long <- plot_data %>%
pivot_longer(
cols = all_of(variables),
names_to = "variable",
values_to = "value"
)
# Create plot
y_label <- if (use_zscore) "Z-Score" else "Value"
p <- ggplot(plot_data_long, aes(x = year, y = value, color = variable)) +
geom_line(linewidth = 0.75, na.rm = TRUE) +
geom_vline(xintercept = 2020, linetype = "dashed", color = "gray50", alpha = 0.5) +
labs(x = "Year", y = y_label, color = "Variable") +
theme_minimal() +
theme(legend.position = "bottom")
# Add horizontal line at 0 for z-scores
if (use_zscore) {
p <- p + geom_hline(yintercept = 0, linetype = "dashed", color = "gray40")
}
# Add faceting
if (facet_by == "country" && length(countries) > 1) {
p <- p + facet_wrap(~ country_name, scales = "free_y")
} else if (facet_by == "variable" && length(variables) > 1) {
p <- p + facet_wrap(~ variable, scales = "free_y")
}
return(p)
}
# Example usage:
countries_to_plot <- c("TUR", "HUN", "POL")
variables_to_plot <- c("spi_comp", "sdg_overall", "di_score ", "log_gdppc")
trend_plot <- plot_trends(panel_data, countries_to_plot, variables_to_plot, use_zscore = TRUE, facet_by = "country")
# Example usage:
countries_to_plot <- c("TUR", "HUN", "POL")
variables_to_plot <- c("spi_comp", "sdg_overall", "di_score", "log_gdppc")
trend_plot <- plot_trends(panel_data, countries_to_plot, variables_to_plot, use_zscore = TRUE, facet_by = "country")
print(trend_plot)
trend_plot <- plot_trends(panel_data, countries_to_plot, variables_to_plot, use_zscore = TRUE, facet_by = "variable")
print(trend_plot)
# Example usage:
countries_to_plot <- "POL" #c("TUR", "HUN", "POL")
variables_to_plot <- c("spi_comp", "sdg_overall", "di_score", "log_gdppc")
trend_plot <- plot_trends(panel_data, countries_to_plot, variables_to_plot, use_zscore = TRUE, facet_by = "country")
print(trend_plot)
# Example usage:
countries_to_plot <- "USA" #c("TUR", "HUN", "POL")
variables_to_plot <- c("spi_comp", "sdg_overall", "di_score", "log_gdppc")
trend_plot <- plot_trends(panel_data, countries_to_plot, variables_to_plot, use_zscore = TRUE, facet_by = "country")
print(trend_plot)
