theme(plot.title = element_text(size = 14))+
theme_minimal()
# side by side comparison using patchwork
library(patchwork)
sdg_spi_s2_scatter + sdg_di_s2_scatter + plot_layout(ncol = 2)
#ggsave("component_2/figures/stage2/s2_scatterplots.png", width = 12, height = 8)
# Chunk 5
# Model POLS: Basic FE model with DI as predictor
model_pols <- plm(formula = sdg_overall ~ di_score
+ plm::lag(di_score, 1)
+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
data = panel_data,
model = "pooling")
summary(model_pols, vcov = vcovHC(model_pols, cluster = "group", type = "HC1"))
# Chunk 6
# Contemporaneous Effects: SDG ~ DI [REPORTED]
model_fd_current <- plm(formula = sdg_overall ~ di_score
+ log_gdppc
+ factor(year),
data = panel_data,
model = "fd")
summary(model_fd_current, vcov = vcovHC(model_fd_current, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI [REPORTED]
model_fd <- plm(formula = sdg_overall ~ di_score
+ plm::lag(di_score, 1)
+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
data = panel_data,
model = "fd")
summary(model_fd, vcov = vcovHC(model_fd, cluster = "group", type = "HC1"))
# ensure correct names
names(coef(model_fd))
# joint significance - FD
linearHypothesis(
model_fd,
c("di_score",
"plm::lag(di_score, 1)",
"plm::lag(di_score, 2)"),
vcov. = vcovHC(model_fd, cluster = "group", type = "HC1"),
test = "F"
)
# cumulative effect - FD
linearHypothesis(
model_fd,
c("di_score + plm::lag(di_score, 1) + plm::lag(di_score, 2) = 0"),
vcov. = vcovHC(model_fd, cluster = "group", type = "HC1"),
test = "F"
)
# CI for FD model with Lag2
coef <- coef(model_fd)
se <- sqrt(diag(vcovHC(model_fd, cluster = "group", type = "HC1")))  # Get standard errors
crit_value <- qt(0.975, df = nobs(model_fd)-length(coef(model_fd)))
ci_low <- coef - crit_value * se
ci_high <- coef + crit_value * se
cbind(ci_low, ci_high)
# Chunk 7
# Contemporaneous Effects: SDG ~ DI [REPORTED]
model_fe_current <- plm(formula = sdg_overall ~ di_score
+ log_gdppc
+ factor(year),
data = panel_data,
model = "within")
summary(model_fe_current, vcov = vcovHC(model_fe_current, cluster = "group", type = "HC1"))
# Adding Lag2: SDG ~ DI [REPORTED]
model_fe <- plm(formula = sdg_overall ~ di_score
+ plm::lag(di_score, 1)
+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
data = panel_data,
model = "within")
summary(model_fe, vcov = vcovHC(model_fe, cluster = "group", type = "HC1"))
# joint significance - FE
linearHypothesis(
model_fe,
c("di_score = 0", "plm::lag(di_score, 1) = 0", "plm::lag(di_score, 2) = 0"),
vcov. = vcovHC(model_fe, cluster = "group", type = "HC1"),
test = "F"
)
# ensure correct names
# names(coef(model_fe))
# cumulative effect - FE
linearHypothesis(
model_fe,
c("di_score + plm::lag(di_score, 1) + plm::lag(di_score, 2) = 0"),
vcov. = vcovHC(model_fe, cluster = "group", type = "HC1"),
test = "F"
)
# CI for FE model with Lag2
coef <- coef(model_fe)
se <- sqrt(diag(vcovHC(model_fe, cluster = "group", type = "HC1")))  # Get standard errors
crit_value <- qt(0.975, df = nobs(model_fe)-length(coef(model_fe)))
ci_low <- coef - crit_value * se
ci_high <- coef + crit_value * se
cbind(ci_low, ci_high)
# Chunk 9
# Results from the main regression table
## DIRECT EFFECTS MODEL ###
# First Difference
fd_coef_de <- c(0.035, 0.148, -0.184)   # Year 0, Year 1, Year 2
fd_se_de   <- c(0.091, 0.074, 0.127)    # corresponding SEs
# Two-Way Fixed Effects
twfe_coef_de <- c(0.096, 0.167, -0.201)  # Year 0, Year 1, Year 2
twfe_se_de   <- c(0.080, 0.100, 0.128)   # corresponding SEs
# Calculate 95% CIs (Â±1.96*SE)
fd_lower <- fd_coef_de - 1.96 * fd_se_de
fd_upper <- fd_coef_de + 1.96 * fd_se_de
twfe_lower <- twfe_coef_de - 1.96 * twfe_se_de
twfe_upper <- twfe_coef_de + 1.96 * twfe_se_de
# Calculate cumulative effects
fd_cumul <- cumsum(fd_coef_de)
twfe_cumul <- cumsum(twfe_coef_de)
# Calculate cumulative CIs (uncertainty compounds)
# For cumulative: Var(sum) = sum of variances (assuming independence)
fd_cumul_se <- sqrt(cumsum(fd_se_de^2))
fd_cumul_lower <- fd_cumul - 1.96 * fd_cumul_se
fd_cumul_upper <- fd_cumul + 1.96 * fd_cumul_se
twfe_cumul_se <- sqrt(cumsum(twfe_se_de^2))
twfe_cumul_lower <- twfe_cumul - 1.96 * twfe_cumul_se
twfe_cumul_upper <- twfe_cumul + 1.96 * twfe_cumul_se
# Create data frames
periods <- c(0, 1, 2)
period_labels <- c("Year 0", "Year 1", "Year 2")
# Instantaneous effects data
instant_data <- data.frame(
period = rep(periods, 2),
label = rep(period_labels, 2),
effect = c(fd_coef_de, twfe_coef_de),
lower = c(fd_lower, twfe_lower),
upper = c(fd_upper, twfe_upper),
model = rep(c("FD", "TWFE"), each = 3)
)
# Cumulative effects data
cumul_data <- data.frame(
period = rep(periods, 2),
label = rep(period_labels, 2),
effect = c(fd_cumul, twfe_cumul),
lower = c(fd_cumul_lower, twfe_cumul_lower),
upper = c(fd_cumul_upper, twfe_cumul_upper),
model = rep(c("FD", "TWFE"), each = 3)
)
# Plot 1: Instantaneous Effects
p1_de <- ggplot(instant_data, aes(x = factor(period, labels = period_labels),
y = effect, color = model, fill = model, group = model)) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
geom_line(linewidth = 1) +
geom_vline(xintercept = "Year 0", linewidth = 0.25, color = "gray15") +
geom_point(size = 3) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
scale_color_manual(values = c("FD" = "#3182bd", "TWFE" = "#e6550d")) +
scale_fill_manual(values = c("FD" = "#3182bd", "TWFE" = "#e6550d")) +
labs(x = "Time Since Democracy Increase",
y = "Effect per Period",
title = "Period-Specific Effects") +
theme_minimal(base_size = 12) +
theme(legend.position = "bottom",
plot.title = element_text(size = 11, face = "bold"))
# Plot 2: Cumulative Effects
p2_de <- ggplot(cumul_data, aes(x = factor(period, labels = period_labels),
y = effect, color = model, fill = model, group = model)) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
geom_line(linewidth = 1) +
geom_vline(xintercept = "Year 0", linewidth = 0.25, color = "gray15") +
geom_point(size = 3) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
scale_color_manual(values = c("FD" = "#3182bd", "TWFE" = "#e6550d")) +
scale_fill_manual(values = c("FD" = "#3182bd", "TWFE" = "#e6550d")) +
labs(x = "Time Since Democracy Increase",
y = "Cumulative Effect",
title = "Cumulative Effects Over Time") +
theme_minimal(base_size = 12) +
theme(legend.position = "bottom",
plot.title = element_text(size = 11, face = "bold"))
# Combine plots
combined_plot_de <- p1_de + p2_de +
plot_layout(guides = "collect") +
plot_annotation(title = "Dynamic Effects of Democracy on SDG Performance\n(with 95% Confidence Intervals)",
theme = theme(
plot.title = element_text(hjust = 0.5, size = 14),
plot.margin = margin(t = 10, r = 10, b = 10, l = 10)
)
) &
theme(
plot.margin = margin(5, 5, 5, 5),  # inner margins around each subplot
legend.position = "bottom",
legend.title = element_blank()
)
combined_plot_de
# Save normally
ggsave("component_2/figures/stage2/direct_effects/twfe_fd_dynamic_effects_de_s2_color.png",
plot = combined_plot_de,
width = 12, height = 6)
################# Creating + saving black and white version #################
p1_de_bw <- p1_de +
scale_color_manual(values = c("FD" = "grey20", "TWFE" = "grey45")) +
scale_fill_manual(values = c("FD" = "grey20", "TWFE" = "grey45"))
p2_de_bw <- p2_de +
scale_color_manual(values = c("FD" = "grey20", "TWFE" = "grey45")) +
scale_fill_manual(values = c("FD" = "grey20", "TWFE" = "grey45"))
#  Combine bw plots
combined_plot_de_bw <- p1_de_bw + p2_de_bw +
plot_layout(guides = "collect") +
plot_annotation(title = "Dynamic Effects of Democracy on SDG Performance\n(with 95% Confidence Intervals)",
theme = theme(
plot.title = element_text(hjust = 0.5, size = 14),
plot.margin = margin(t = 10, r = 10, b = 10, l = 10)
)
) &
theme(
plot.margin = margin(5, 5, 5, 5),  # inner margins around each subplot
legend.position = "bottom",
legend.title = element_blank()
)
combined_plot_de_bw
# Save bw version
ggsave("component_2/figures/stage2/direct_effects/twfe_fd_dynamic_effects_de_s2_bw.png",
plot = combined_plot_de_bw,
width = 12, height = 6)
# Chunk 10
# Adding Lag2: SPI ~ DI
ols_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp + plm::lag(spi_comp, 1)
+ plm::lag(spi_comp, 2) + di_score + plm::lag(di_score, 1)
+ plm::lag(di_score, 2) + log_gdppc
#+ factor(income_level_recoded)
+ factor(year),
model = "pooling",
data = panel_data)
summary(ols_sdg_spi_L2, vcov = vcovHC(ols_sdg_spi_L2, cluster = "group", type = "HC1"))
## UNIT TEST
# Checking which countries are dropped due to missingness
# Rows actually used in the model
model_rows <- rownames(model.frame(ols_sdg_spi_L2))
used_ids <- unique(panel_data[model_rows, "country_code"])
dropped_ids <- setdiff(unique(panel_data1$country_code), used_ids)
length(used_ids)      # should be 155
length(dropped_ids)   # should be 7
dropped_ids           # which countries are excluded
# Chunk 11
# Contemporaneous Effects: SDG ~ DI + SPI [REPORTED]
fd_sdg_spi_current <- plm(formula = sdg_overall ~ spi_comp
+ di_score
+ log_gdppc
+ factor(year),
model = "fd",
data = panel_data)
summary(fd_sdg_spi_current, vcov = vcovHC(fd_sdg_spi_current, cluster = "group", type = "HC1"))
# Adding Lag2: SDG ~ DI + SPI [REPORTED]
fd_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
+ plm::lag(spi_comp, 1)
+ plm::lag(spi_comp, 2)
+ di_score
+ plm::lag(di_score, 1)
+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "fd",
data = panel_data)
summary(fd_sdg_spi_L2, vcov = vcovHC(fd_sdg_spi_L2, cluster = "group", type = "HC1"))
# ensure correct names
# names(coef(fd_sdg_spi_L2))
# Joint significance - MEDIATION, FIRST DIFFERENCE, X = DI
linearHypothesis(
fd_sdg_spi_L2,
c("di_score = 0", "plm::lag(di_score, 1) = 0", "plm::lag(di_score, 2) = 0"),
vcov. = vcovHC(fd_sdg_spi_L2, cluster = "group", type = "HC1"),
test = "F"
)
# cumulative effects - MEDIATION, FIRST DIFFERENCE, X = DI
linearHypothesis(
fd_sdg_spi_L2,
c("di_score + plm::lag(di_score, 1) + plm::lag(di_score, 2) = 0"),
vcov. = vcovHC(fd_sdg_spi_L2, cluster = "group", type = "HC1"),
test = "F"
)
# Joint significance, MEDIATION, FIRST DIFFERENCE, Z = SPI
linearHypothesis(
fd_sdg_spi_L2,
c("spi_comp = 0", "plm::lag(spi_comp, 1) = 0", "plm::lag(spi_comp, 2) = 0"),
vcov. = vcovHC(fd_sdg_spi_L2, cluster = "group", type = "HC1"),
test = "F"
)
# cumulative effects - MEDIATION, FIRST DIFFERENCE, Z = SPI
linearHypothesis(
fd_sdg_spi_L2,
c("spi_comp + plm::lag(spi_comp, 1) + plm::lag(spi_comp, 2) = 0"),
vcov. = vcovHC(fd_sdg_spi_L2, cluster = "group", type = "HC1"),
test = "F"
)
# CIs
coef <- coef(fd_sdg_spi_L2)
se <- sqrt(diag(vcovHC(fd_sdg_spi_L2, cluster = "group", type = "HC1")))  # Get standard errors
crit_value <- qt(0.975, df = nobs(fd_sdg_spi_L2)-length(coef(fd_sdg_spi_L2)))
ci_low <- coef - crit_value * se
ci_high <- coef + crit_value * se
cbind(ci_low, ci_high)
# Contemporaneous Effects: SDG ~ DI + SPI [REPORTED]
fe_sdg_spi_current <- plm(formula = sdg_overall ~ spi_comp
+ di_score
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_current, vcov = vcovHC(fe_sdg_spi_current, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
+ plm::lag(spi_comp, 1)
+ plm::lag(spi_comp, 2)
+ di_score
+ plm::lag(di_score, 1)
+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# ensure correct names
# names(coef(fe_sdg_spi_L2))
# Joint significance - MEDIATION, TW FIXED EFFECTS, X = DI
linearHypothesis(
fe_sdg_spi_L2,
c("di_score = 0", "plm::lag(di_score, 1) = 0", "plm::lag(di_score, 2) = 0"),
vcov. = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"),
test = "F"
)
# cumulative effects - MEDIATION, TW FIXED EFFECTS, X = DI
linearHypothesis(
fe_sdg_spi_L2,
c("di_score + plm::lag(di_score, 1) + plm::lag(di_score, 2) = 0"),
vcov. = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"),
test = "F"
)
# Joint significance - MEDIATION, TW FIXED EFFECTS, Z = SPI
linearHypothesis(
fe_sdg_spi_L2,
c("spi_comp = 0", "plm::lag(spi_comp, 1) = 0", "plm::lag(spi_comp, 2) = 0"),
vcov. = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"),
test = "F"
)
# cumulative effects - MEDIATION, TW FIXED EFFECTS, Z = SPI
linearHypothesis(
fe_sdg_spi_L2,
c("spi_comp + plm::lag(spi_comp, 1) + plm::lag(spi_comp, 2) = 0"),
vcov. = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"),
test = "F"
)
# CI for all variables (L2 model)
coef <- coef(fe_sdg_spi_L2)
se <- sqrt(diag(vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1")))  # Get standard errors
crit_value <- qt(0.975, df = nobs(fe_sdg_spi_L2)-length(coef(fe_sdg_spi_L2)))
ci_low <- coef - crit_value * se
ci_high <- coef + crit_value * se
cbind(ci_low, ci_high)
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
#+ plm::lag(spi_comp, 1)
#+ plm::lag(spi_comp, 2)
#+ di_score
+ plm::lag(di_score, 1)
+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ #spi_comp
plm::lag(spi_comp, 1)
#+ plm::lag(spi_comp, 2)
#+ di_score
#+ plm::lag(di_score, 1)
+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
plm::lag(spi_comp, 1)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
+ plm::lag(spi_comp, 1)
#+ plm::lag(spi_comp, 2)
#+ di_score
#+ plm::lag(di_score, 1)
+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
+ plm::lag(spi_comp, 1)
#+ plm::lag(spi_comp, 2)
+ di_score
#+ plm::lag(di_score, 1)
+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
+ plm::lag(spi_comp, 1)
#+ plm::lag(spi_comp, 2)
+ di_score
#+ plm::lag(di_score, 1)
#+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ #spi_comp
plm::lag(spi_comp, 1)
#+ plm::lag(spi_comp, 2)
+ di_score
#+ plm::lag(di_score, 1)
#+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ #spi_comp
#plm::lag(spi_comp, 1)
plm::lag(spi_comp, 2)
#+ di_score
+ plm::lag(di_score, 1)
#+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ #spi_comp
#plm::lag(spi_comp, 1)
plm::lag(spi_comp, 2)
+ di_score
#+ plm::lag(di_score, 1)
#+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ #spi_comp
plm::lag(spi_comp, 1)
plm::lag(spi_comp, 2)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ #spi_comp
plm::lag(spi_comp, 1)
+ plm::lag(spi_comp, 2)
+ di_score
#+ plm::lag(di_score, 1)
#+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
plm::lag(spi_comp, 1)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
+ plm::lag(spi_comp, 1)
+ plm::lag(spi_comp, 2)
+ di_score
#+ plm::lag(di_score, 1)
#+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
+ plm::lag(spi_comp, 1)
+ plm::lag(spi_comp, 2)
+ di_score
+ plm::lag(di_score, 1)
#+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
# Adding Lag2: SPI ~ DI
fe_sdg_spi_L2 <- plm(formula = sdg_overall ~ spi_comp
+ plm::lag(spi_comp, 1)
+ plm::lag(spi_comp, 2)
+ di_score
+ plm::lag(di_score, 1)
+ plm::lag(di_score, 2)
+ log_gdppc
+ factor(year),
model = "within",
data = panel_data)
summary(fe_sdg_spi_L2, vcov = vcovHC(fe_sdg_spi_L2, cluster = "group", type = "HC1"))
